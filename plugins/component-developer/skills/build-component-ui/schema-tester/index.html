<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Keboola Component Schema Tester</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@json-editor/json-editor@latest/dist/css/jsoneditor.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@json-editor/json-editor@latest/dist/jsoneditor.min.js"></script>
    <style>
        body {
            padding: 20px;
            background: linear-gradient(135deg, #1BC98E 0%, #0097A7 100%);
            min-height: 100vh;
        }
        .main-container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #1BC98E 0%, #0097A7 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }
        .logo {
            font-size: 3rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        .logo-icon {
            font-size: 2.5rem;
        }
        .logo-text {
            font-size: 1.8rem;
            font-weight: 700;
            letter-spacing: 1px;
        }
        .header h1 {
            margin: 10px 0 0 0;
            font-size: 1.5rem;
            font-weight: 600;
        }
        .header .credits {
            margin-top: 15px;
            font-size: 0.9rem;
            opacity: 0.9;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        .sidebar .reload-button {
            width: 100%;
            background: #1BC98E;
            border: none;
            color: white;
            padding: 12px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            margin-bottom: 25px;
            font-size: 1rem;
        }
        .sidebar .reload-button:hover {
            background: #0097A7;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(27, 201, 142, 0.3);
        }
        .content {
            display: flex;
            gap: 0;
            min-height: calc(100vh - 200px);
        }
        .sidebar {
            width: 320px;
            background: #f8f9fa;
            padding: 25px;
            border-right: 2px solid #dee2e6;
            overflow-y: auto;
        }
        .sidebar h3 {
            font-size: 1rem;
            font-weight: 700;
            color: #495057;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .main-content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }
        .path-selector {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #dee2e6;
        }
        .path-selector label {
            font-weight: 600;
            margin-bottom: 10px;
            display: block;
            color: #495057;
        }
        .path-selector .input-group {
            display: flex;
            gap: 10px;
            align-items: stretch;
        }
        .path-selector input[type="text"] {
            flex: 1;
            padding: 10px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-family: monospace;
        }
        .path-selector .browse-btn {
            padding: 10px 20px;
            background: #1BC98E;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            white-space: nowrap;
        }
        .path-selector .browse-btn:hover {
            background: #0097A7;
        }
        .path-selector input[type="file"] {
            display: none;
        }
        .path-selector small {
            display: block;
            margin-top: 8px;
            color: #6c757d;
        }
        .nav-tabs {
            border-bottom: 2px solid #dee2e6;
            margin-bottom: 30px;
        }
        .nav-tabs .nav-link {
            border: none;
            color: #6c757d;
            font-weight: 600;
            padding: 15px 30px;
            transition: all 0.3s;
        }
        .nav-tabs .nav-link:hover {
            color: #1BC98E;
            background: #f8f9fa;
        }
        .nav-tabs .nav-link.active {
            color: #1BC98E;
            border-bottom: 3px solid #1BC98E;
            background: transparent;
        }
        .tab-content {
            min-height: 400px;
        }
        .schema-section {
            margin-bottom: 40px;
            padding: 25px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            background-color: #f8f9fa;
        }
        .schema-section h2 {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: #0097A7;
            padding-bottom: 10px;
            border-bottom: 2px solid #dee2e6;
        }
        .form-container {
            background: white;
            padding: 20px;
            border-radius: 4px;
            margin-bottom: 20px;
        }
        .output-section {
            margin-top: 20px;
            padding: 15px;
            background-color: #e9ecef;
            border-radius: 4px;
            border-left: 4px solid #1BC98E;
        }
        .output-section h3 {
            font-size: 1rem;
            margin-bottom: 10px;
            color: #1BC98E;
        }
        .output-section pre {
            background-color: #fff;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
            max-height: 400px;
        }
        .je-object__container {
            padding: 15px;
            background: white;
            border-radius: 4px;
        }
        .btn-primary {
            background: #1BC98E;
            border: none;
            padding: 12px 30px;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }
        .btn-primary:hover {
            background: #15B67D;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(27, 201, 142, 0.3);
        }
        .btn-success {
            background: #0097A7;
            border: none;
            padding: 12px 30px;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        .btn-success:hover {
            background: #00838F;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 151, 167, 0.3);
        }
        .badge {
            font-size: 0.75rem;
            padding: 4px 8px;
            margin-left: 8px;
            vertical-align: middle;
        }
        .combined-config {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 8px;
        }
        .combined-config h3 {
            color: #0097A7;
            margin-bottom: 15px;
        }
        .combined-config .help-text {
            color: #6c757d;
            margin-bottom: 20px;
            padding: 15px;
            background: white;
            border-left: 4px solid #1BC98E;
            border-radius: 4px;
        }
        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .alert-info {
            background: white;
            border: 1px solid #dee2e6;
            color: #495057;
        }
        .alert-info strong {
            color: #1BC98E;
            display: block;
            margin-bottom: 10px;
        }
        .alert-info ul {
            margin: 0;
            padding-left: 20px;
            font-size: 0.9rem;
            line-height: 1.8;
        }
        .alert-success {
            background: #d4edda;
            border: 1px solid #1BC98E;
            color: #155724;
            font-size: 0.9rem;
        }
        .alert-danger {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="main-container">
        <div class="header">
            <div class="logo">
                <span class="logo-icon">üè≠</span>
                <span class="logo-text">COMPONENT FACTORY</span>
            </div>
            <h1>Schema Tester</h1>
            <div class="credits">
                <span>by Component Factory Team</span>
                <span style="opacity: 0.7;">‚Ä¢</span>
                <span style="opacity: 0.7;">Keboola Platform</span>
            </div>
        </div>

        <div class="content">
            <!-- Sidebar -->
            <div class="sidebar">
                <button class="reload-button" onclick="reloadSchemas()">üîÑ Reload Schemas</button>

                <h3>Configuration</h3>
                <div class="path-selector">
                    <label for="config-path">üìÅ Configuration Path</label>
                    <div class="input-group">
                        <input
                            type="text"
                            id="config-path"
                            value="../component_config"
                            placeholder="../component_config"
                            onchange="reloadSchemas()"
                        />
                        <input
                            type="file"
                            id="folder-picker"
                            webkitdirectory
                            directory
                            multiple
                        />
                        <button class="browse-btn" onclick="handleFolderSelection()">
                            üìÇ Browse
                        </button>
                    </div>
                    <small>Path to folder containing configSchema.json and configRowSchema.json</small>
                </div>

                <div id="status"></div>

                <h3>Quick Start</h3>
                <div class="alert alert-info">
                    <strong>üí° How to use:</strong>
                    <ul>
                        <li>Edit schemas in your component_config/ folder</li>
                        <li>Click "üîÑ Reload Schemas" to see changes</li>
                        <li>Test conditional fields by changing values</li>
                        <li>Use "Resulting configuration" tab for final config</li>
                    </ul>
                </div>
            </div>

            <!-- Main Content -->
            <div class="main-content">

                <!-- Tabs Navigation -->
                <ul class="nav nav-tabs" id="configTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="component-tab" data-bs-toggle="tab" data-bs-target="#component-pane" type="button" role="tab">
                            üìã Schema configuration
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="row-tab" data-bs-toggle="tab" data-bs-target="#row-pane" type="button" role="tab">
                            üîß Row schema configuration
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="combined-tab" data-bs-toggle="tab" data-bs-target="#combined-pane" type="button" role="tab">
                            üì¶ Resulting configuration
                        </button>
                    </li>
                </ul>

            <!-- Tab Content -->
            <div class="tab-content" id="configTabContent">
                <!-- Component Configuration Tab -->
                <div class="tab-pane fade show active" id="component-pane" role="tabpanel">
                    <div class="schema-section">
                        <h2>Component Configuration</h2>
                        <small class="text-muted">Global settings shared across all configuration rows</small>
                        <div class="form-container">
                            <div id="component-editor"></div>
                            <button class="btn-primary" onclick="validateComponentForm()">Validate Form</button>
                        </div>
                        <div class="output-section">
                            <h3>‚úÖ Generated Component Configuration:</h3>
                            <pre id="component-output">{}</pre>
                        </div>
                    </div>
                </div>

                <!-- Row Configuration Tab -->
                <div class="tab-pane fade" id="row-pane" role="tabpanel">
                    <div class="schema-section">
                        <h2>Row Configuration</h2>
                        <small class="text-muted">Row-specific settings for each data source/table</small>
                        <div class="form-container">
                            <div id="row-editor"></div>
                            <button class="btn-primary" onclick="validateRowForm()">Validate Form</button>
                        </div>
                        <div class="output-section">
                            <h3>‚úÖ Generated Row Configuration:</h3>
                            <pre id="row-output">{}</pre>
                        </div>
                    </div>
                </div>

                <!-- Combined Configuration Tab -->
                <div class="tab-pane fade" id="combined-pane" role="tabpanel">
                    <div class="combined-config">
                        <h3>üì¶ Complete Component Configuration</h3>
                        <div class="help-text">
                            <strong>üí° How to use:</strong> This is a complete config.json ready to paste into Keboola platform.
                            All component and row parameters are merged into a single <code>parameters</code> object.
                        </div>
                        <button class="btn-success" onclick="copyToClipboard()">üìã Copy to Clipboard</button>
                        <div class="output-section">
                            <h3>‚úÖ Complete config.json</h3>
                            <pre id="combined-output">{}</pre>
                        </div>
                    </div>
                </div>
            </div>
            </div> <!-- end main-content -->
        </div> <!-- end content -->
    </div> <!-- end main-container -->

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let componentEditor, rowEditor;

        // Get config path from input
        function getConfigPath() {
            return document.getElementById('config-path').value || '../component_config';
        }

        // Handle folder picker with File System Access API
        let selectedFolderHandle = null;
        let lastUsedDirectoryHandle = null;

        // Try to restore last used directory from IndexedDB on page load
        async function restoreLastDirectory() {
            try {
                if ('indexedDB' in window) {
                    const db = await openDirectoryDB();
                    const handle = await getStoredDirectoryHandle(db);
                    if (handle) {
                        lastUsedDirectoryHandle = handle;
                    }
                }
            } catch (err) {
                console.log('Could not restore last directory:', err);
            }
        }

        async function handleFolderSelection() {
            try {
                // Use File System Access API if available (modern browsers)
                if ('showDirectoryPicker' in window) {
                    let options = {
                        mode: 'read'
                    };

                    // If we have a previously used directory, start there
                    if (lastUsedDirectoryHandle) {
                        options.startIn = lastUsedDirectoryHandle;
                    } else {
                        // Show helpful tip on first use
                        const currentPath = window.location.pathname;
                        if (currentPath.includes('/tools/schema-tester') || currentPath.includes('/.claude/plugins')) {
                            document.getElementById('status').innerHTML =
                                '<div class="alert alert-info" style="margin-bottom: 10px; font-size: 0.85rem;">' +
                                '<strong>üí° First time?</strong><br>' +
                                'Navigate to your project root, then select the <code>component_config</code> folder' +
                                '</div>';
                        }
                    }

                    const folderHandle = await window.showDirectoryPicker(options);
                    selectedFolderHandle = folderHandle;

                    // Store this directory handle for next time
                    lastUsedDirectoryHandle = folderHandle;

                    // Try to persist to IndexedDB for next session
                    try {
                        const db = await openDirectoryDB();
                        await storeDirectoryHandle(db, folderHandle);
                    } catch (err) {
                        console.log('Could not persist directory:', err);
                    }

                    // Update the input with folder name
                    document.getElementById('config-path').value = folderHandle.name;

                    // Try to load schemas from the selected folder
                    await loadSchemasFromHandle(folderHandle);
                } else {
                    // Fallback to traditional file input
                    document.getElementById('folder-picker').click();
                }
            } catch (err) {
                if (err.name !== 'AbortError') {
                    console.error('Error selecting folder:', err);
                    alert('Error selecting folder: ' + err.message);
                }
            }
        }

        // IndexedDB helpers for persisting directory handle
        function openDirectoryDB() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open('SchemaTesterDB', 1);
                request.onerror = () => reject(request.error);
                request.onsuccess = () => resolve(request.result);
                request.onupgradeneeded = (event) => {
                    const db = event.target.result;
                    if (!db.objectStoreNames.contains('directories')) {
                        db.createObjectStore('directories');
                    }
                };
            });
        }

        async function storeDirectoryHandle(db, handle) {
            const tx = db.transaction('directories', 'readwrite');
            const store = tx.objectStore('directories');
            await store.put(handle, 'lastUsed');
        }

        async function getStoredDirectoryHandle(db) {
            const tx = db.transaction('directories', 'readonly');
            const store = tx.objectStore('directories');
            return new Promise((resolve) => {
                const request = store.get('lastUsed');
                request.onsuccess = () => resolve(request.result);
                request.onerror = () => resolve(null);
            });
        }

        // Load schemas from File System Access API handle
        async function loadSchemasFromHandle(folderHandle) {
            try {
                const configSchemaFile = await folderHandle.getFileHandle('configSchema.json');
                const configRowSchemaFile = await folderHandle.getFileHandle('configRowSchema.json');

                const configSchemaContent = await (await configSchemaFile.getFile()).text();
                const configRowSchemaContent = await (await configRowSchemaFile.getFile()).text();

                const componentSchema = JSON.parse(configSchemaContent);
                const rowSchema = JSON.parse(configRowSchemaContent);

                // Initialize editors with loaded schemas
                initializeEditors(componentSchema, rowSchema);

                document.getElementById('status').innerHTML = '<div class="alert alert-success">‚úÖ Schemas loaded successfully from selected folder!</div>';
            } catch (err) {
                console.error('Error loading schemas:', err);
                document.getElementById('status').innerHTML = `<div class="alert alert-danger">‚ùå Error: ${err.message}</div>`;
            }
        }

        // Fallback for older browsers
        document.addEventListener('DOMContentLoaded', function() {
            const folderPicker = document.getElementById('folder-picker');

            folderPicker.addEventListener('change', function(e) {
                if (e.target.files.length > 0) {
                    const firstFile = e.target.files[0];
                    const fullPath = firstFile.webkitRelativePath || firstFile.name;
                    const folderName = fullPath.split('/')[0];

                    document.getElementById('config-path').value = folderName;
                    alert(`Selected folder: ${folderName}\n\nNote: Due to browser limitations, please use the text input to specify the full path.`);
                }
            });
        });

        // Preprocess schema to handle Keboola-specific features
        function preprocessSchema(schema) {
            const processed = JSON.parse(JSON.stringify(schema)); // Deep clone

            if (processed.properties) {
                Object.keys(processed.properties).forEach(key => {
                    const prop = processed.properties[key];

                    // Handle button type (not standard JSON Schema)
                    if (prop.type === 'button') {
                        const action = prop.options?.async?.action || 'unknown';
                        const label = prop.options?.async?.label || prop.title || 'Button';

                        // Convert button to a readonly text field that shows button info
                        processed.properties[key] = {
                            type: 'string',
                            title: `üîò ${prop.title || label}`,
                            description: `Sync Action: "${label}" ‚Üí Action: ${action}\n\n(Note: Buttons trigger sync actions and cannot be executed in this tester)`,
                            default: `[Button] ${label}`,
                            readOnly: true,
                            options: {
                                inputAttributes: {
                                    style: 'background-color: #e7f7f4; border: 2px solid #1BC98E; font-weight: 600; color: #00695C; cursor: not-allowed;'
                                }
                            },
                            propertyOrder: prop.propertyOrder
                        };
                    }

                    // Ensure multiselect arrays work properly
                    if (prop.type === 'array' && prop.format === 'select') {
                        // JSONEditor needs these options for multiselect
                        if (!prop.options) prop.options = {};
                        prop.uniqueItems = true;

                        // If it has async loading, add note to description
                        if (prop.options.async) {
                            const originalDesc = prop.description || '';
                            const action = prop.options.async.action;
                            prop.description = originalDesc + `\n\nüí° Dynamic loading: ${action}`;
                        }
                    }
                });
            }

            return processed;
        }

        // Initialize editors with schemas
        function initializeEditors(componentSchema, rowSchema) {
            // Preprocess schemas to handle Keboola-specific features
            const processedComponentSchema = preprocessSchema(componentSchema);
            const processedRowSchema = preprocessSchema(rowSchema);

            // Initialize Component Editor
            if (componentEditor) componentEditor.destroy();
            const componentElement = document.getElementById('component-editor');
            componentEditor = new JSONEditor(componentElement, {
                schema: processedComponentSchema,
                theme: 'bootstrap5',
                iconlib: 'bootstrap',
                disable_collapse: false,
                disable_edit_json: false,
                disable_properties: false,
                show_errors: 'always',
                prompt_before_delete: false,
                no_additional_properties: false,
                required_by_default: false,
                keep_oneof_values: false,
                use_default_values: true,
                select2: {
                    tags: true,
                    width: '100%'
                }
            });

            componentEditor.on('ready', function() {
                componentEditor.on('change', function() {
                    updateComponentOutput();
                    updateCombinedOutput();
                });
                setTimeout(() => updateComponentOutput(), 100);
            });

            // Initialize Row Editor
            if (rowEditor) rowEditor.destroy();
            const rowElement = document.getElementById('row-editor');
            rowEditor = new JSONEditor(rowElement, {
                schema: processedRowSchema,
                theme: 'bootstrap5',
                iconlib: 'bootstrap',
                disable_collapse: false,
                disable_edit_json: false,
                disable_properties: false,
                show_errors: 'always',
                prompt_before_delete: false,
                no_additional_properties: false,
                required_by_default: false,
                keep_oneof_values: false,
                use_default_values: true,
                select2: {
                    tags: true,
                    width: '100%'
                }
            });

            rowEditor.on('ready', function() {
                rowEditor.on('change', function() {
                    updateRowOutput();
                    updateCombinedOutput();
                });
                setTimeout(() => {
                    updateRowOutput();
                    updateCombinedOutput();
                }, 100);
            });
        }

        // Load schemas from path
        async function loadSchemas(silent = false) {
            try {
                const configPath = getConfigPath();
                const timestamp = new Date().getTime();
                const [compResp, rowResp] = await Promise.all([
                    fetch(`${configPath}/configSchema.json?t=${timestamp}`),
                    fetch(`${configPath}/configRowSchema.json?t=${timestamp}`)
                ]);

                if (!compResp.ok || !rowResp.ok) {
                    throw new Error(`Failed to load schemas from "${configPath}". Check the path and try again.`);
                }

                const componentSchema = await compResp.json();
                const rowSchema = await rowResp.json();

                initializeEditors(componentSchema, rowSchema);

                // Show success message if not silent
                if (!silent) {
                    document.getElementById('status').innerHTML =
                        '<div class="alert alert-success" style="margin-bottom: 10px;">' +
                        '‚úÖ Schemas loaded from: ' + configPath +
                        '</div>';
                }

            } catch (error) {
                console.error('Error loading schemas:', error);

                // Only show error if not silent mode
                if (!silent) {
                    document.getElementById('status').innerHTML =
                        '<div class="alert alert-danger" style="margin-bottom: 10px;">' +
                        '‚ùå Error loading schemas: ' + error.message +
                        '</div>';
                } else {
                    // On initial load, show helpful message instead of error
                    document.getElementById('status').innerHTML =
                        '<div class="alert alert-info" style="margin-bottom: 10px;">' +
                        'üí° Use <strong>Browse</strong> to select your component_config folder, or edit the path above' +
                        '</div>';
                }
            }
        }

        // Reload schemas
        async function reloadSchemas() {
            try {
                // Clear any previous status messages
                document.getElementById('status').innerHTML = '';

                // If we have a folder handle from Browse, use that
                if (selectedFolderHandle) {
                    await loadSchemasFromHandle(selectedFolderHandle);
                } else {
                    // Otherwise use path-based loading (with messages enabled)
                    await loadSchemas(false);
                }
            } catch (error) {
                console.error('Error reloading schemas:', error);
                // Error already shown by loadSchemas/loadSchemasFromHandle
            }
        }

        // Update outputs
        function updateComponentOutput() {
            if (!componentEditor || !componentEditor.ready) return;

            const output = document.getElementById('component-output');
            const errors = componentEditor.validate();

            if (errors.length === 0) {
                output.textContent = JSON.stringify(componentEditor.getValue(), null, 2);
                output.style.borderColor = '#1BC98E';
            } else {
                output.textContent = JSON.stringify(componentEditor.getValue(), null, 2) +
                    '\n\n// ERRORS:\n' + JSON.stringify(errors, null, 2);
                output.style.borderColor = '#dc3545';
            }
        }

        function updateRowOutput() {
            if (!rowEditor || !rowEditor.ready) return;

            const output = document.getElementById('row-output');
            const errors = rowEditor.validate();

            if (errors.length === 0) {
                output.textContent = JSON.stringify(rowEditor.getValue(), null, 2);
                output.style.borderColor = '#1BC98E';
            } else {
                output.textContent = JSON.stringify(rowEditor.getValue(), null, 2) +
                    '\n\n// ERRORS:\n' + JSON.stringify(errors, null, 2);
                output.style.borderColor = '#dc3545';
            }
        }

        function updateCombinedOutput() {
            if (!componentEditor || !componentEditor.ready || !rowEditor || !rowEditor.ready) return;

            const combined = {
                parameters: {
                    ...componentEditor.getValue(),
                    ...rowEditor.getValue()
                }
            };

            document.getElementById('combined-output').textContent =
                JSON.stringify(combined, null, 2);
        }

        // Copy to clipboard
        function copyToClipboard() {
            const text = document.getElementById('combined-output').textContent;
            navigator.clipboard.writeText(text).then(() => {
                alert('‚úÖ Copied to clipboard!');
            }).catch(err => {
                alert('‚ùå Failed to copy: ' + err);
            });
        }

        // Validate forms
        function validateComponentForm() {
            const errors = componentEditor.validate();
            if (errors.length === 0) {
                alert('‚úÖ Component configuration is valid!');
            } else {
                alert('‚ùå Validation errors:\n\n' + errors.map(e => `${e.path}: ${e.message}`).join('\n'));
            }
        }

        function validateRowForm() {
            const errors = rowEditor.validate();
            if (errors.length === 0) {
                alert('‚úÖ Row configuration is valid!');
            } else {
                alert('‚ùå Validation errors:\n\n' + errors.map(e => `${e.path}: ${e.message}`).join('\n'));
            }
        }

        // Initialize on page load
        restoreLastDirectory();
        loadSchemas(true); // Silent mode - no alerts on initial load
    </script>
</body>
</html>
